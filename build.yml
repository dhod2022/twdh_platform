name: build
on: 
  push: 
    branches: 
      - main # push到main branch就觸發流程
jobs:
  build-and-deploy:
    runs-on: Windows Server 2019
    steps:
      # github官方的一個action，用於clone該倉庫的code到工作流中，
      - name: Checkout 🛎️
        uses: actions/checkout@v2
        with:
          persist-credentials: false
        - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: install # will run `yarn install` command
    
      # 指定 node 版本
      - uses: actions/setup-node@v2 
        with:
          node-version: '16'

      - name: Build
        run: |
          npm -g i yarn
          cd twdh_platform 
          yarn install  
          yarn build 
  
      # 連接到ssh，並且做複製操作的action
      - name: Deploy 🚀
        uses: cross-the-world/scp-pipeline@master
        env:
          WELCOME: "ssh scp ssh pipelines"
          LASTSSH: "Doing something after copying"
        with:
         host: ${{ secrets.DR_HOST }}
         user: ${{ secrets.DR_USER }}
         pass: ${{ secrets.DR_PASS }}
         connect_timeout: 10s
         local: './twdh_platform/dist/*' # 下一步要創建的vue項目構建完成後的静態資源路徑
         remote: /www/actionTest # step1 中，在Server上創建用於存放静態資源的資料夾




name: build
on: [main]
jobs:
  build-and-deploy:
    runs-on: Windows Server 2019
    steps:
      - uses: actions/checkout@v2
      - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: install # will run `yarn install` command
      - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: build # will run `yarn build` command
      # - uses: borales/actions-yarn@v3.0.0
        # with:
          # cmd: test # will run `yarn test` command

    steps:
      # github官方的一個action，用於clone該倉庫的code到工作流中，
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false
        - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: install # will run `yarn install` command
    
      # 指定 node 版本
      - uses: actions/setup-node@v2 
        with:
          node-version: '16'

      - name: Build
        run: |
          npm -g i yarn
          cd twdh_platform 
          yarn install  
          yarn build 
  
      # 連接到ssh，並且做複製操作的action
      - name: Deploy
        uses: cross-the-world/scp-pipeline@master
        env:
          WELCOME: "ssh scp ssh pipelines"
          LASTSSH: "Doing something after copying"
        with:
         host: ${{ secrets.DR_HOST }}
         user: ${{ secrets.DR_USER }}
         pass: ${{ secrets.DR_PASS }}
         connect_timeout: 10s
         local: './twdh_platform/dist/*' # 下一步要創建的vue項目構建完成後的静態資源路徑
         remote: /www/actionTest # step1 中，在Server上創建用於存放静態資源的資料夾

